- job:
    name: lp-report-full
    description: "<a href=https://docs.google.com/spreadsheets/d/1DAt6ZWtD6abQVzMBGI6VO37lBLOEuB0D8g3ryiIruTY/edit?usp=sharing>Google doc with report</a> updated manually from csv report of this job"
    logrotate:
      daysToKeep: 30
      numToKeep: 100
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    scm:
      - git:
          url: https://github.com/dmi-try/launchpad-report.git
          branches:
            - master
          skip-tag: true
          wipe-workspace: false
    builders:
      - shell: |
          file_name=${JOB_NAME}-${BUILD_NUMBER}-$(date '+%Y-%m-%d')
          rm -rf venv artifacts
          virtualenv venv
          venv/bin/pip install https://launchpad.net/lazr.authentication/trunk/0.1.2/+download/lazr.authentication-0.1.2.tar.gz
          venv/bin/python setup.py install
          mkdir -p artifacts
          cd artifacts && ../venv/bin/lp-report -a --template ../launchpad_report/template.html --outjson ${file_name}.json
    publishers:
      - archive:
          artifacts: artifacts/*
    triggers:
      - timed: H 23 * * *
    wrappers:
      - timeout:
          timeout: 720
          fail: true
